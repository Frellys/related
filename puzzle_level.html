<!DOCTYPE html>
<html>
<head>
    <title>puzzle_level</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            user-select: none;
            overflow: hidden;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #323232;
            display: table-cell;
            height: 100vh;
            width: 100vw;
            vertical-align: middle;
        }

        .wrap {
            width: 80vmin;
            height: calc(80vmin / 16 * 9);
            margin: 0 auto;
        }

            .wrap > .orig {
                width: 80vmin;
                height: auto;
                position: absolute;
                display: none;
            }

            .wrap > .field {
                height: calc(80vmin / 16 * 9);
                font-size: 0;
            }
    </style>
</head>
<body>
    <script>
        class Scene {
            constructor(name, params) {
                return new this.CreateScene[name](params);
            };
            CreateScene = {
                menu: function () { },
                options: function () { },
                level: function (num) {
                    let rows = 4;
                    let cols = 4;
                    let tiles = [];
                    // create wrap
                    let wrap = document.createElement('div');
                    wrap.className = 'wrap';
                    document.body.appendChild(wrap);
                    // load original image
                    let orig = new Image();
                    orig.className = 'orig';
                    //orig.crossOrigin = 'Anonymous';
                    orig.onload = function () {
                        wrap.appendChild(orig);
                        // create field
                        let field = document.createElement('div');
                        field.className = 'field';
                        for (let r = 0; r < rows; r++) {
                            for (let c = 0; c < cols; c++) {
                                let tile = document.createElement('div');
                                tile.className = 'tile';
                                tile.style.display = 'inline-block';
                                tile.style.width = `calc(80vmin / ${cols})`;
                                tile.style.height = `calc(80vmin / 16 * 9 / ${rows})`;
                                tile.style.backgroundImage = 'url("https://i3.ytimg.com/vi/MG_yFJt3PsM/maxresdefault.jpg")';
                                tile.style.backgroundRepeat = 'no-repeat';
                                tile.style.backgroundPositionX = `calc(0px - (80vmin / ${cols} * ${c}))`;
                                tile.style.backgroundPositionY = `calc(0px - (80vmin / 16 * 9 / ${rows} * ${r}))`;
                                tile.style.backgroundSize = `80vmin calc(80vmin / 16 * 9)`;
                                tile.onmousedown = function (e) {
                                    e.target.style.position = 'absolute';
                                    e.target.style.left = `calc(${e.x + 'px'} - 80vmin / ${cols} / 2)`;
                                    e.target.style.top = `calc(${e.y + 'px'} - 80vmin / 16 * 9 / ${rows} / 2)`;
                                    App.drag.enabled = true;
                                    App.drag.element = e.target;
                                };
                                field.appendChild(tile);
                                tiles.push(tile);
                            }
                        }
                        wrap.appendChild(field);

                    };
                    orig.src = 'https://i3.ytimg.com/vi/MG_yFJt3PsM/maxresdefault.jpg';
                    // set vars
                    this.rows = rows;
                    this.cols = cols;
                    this.tiles = tiles;
                }
            };
            Destroy = function () { };
        };
        /**
         * @namespace
         * @property {Scene} scene - current scene container
         */
        let App = {
            scene: new Scene('level'),
            drag: {
                enabled: false,
                element: null
            }
        };
        window.addEventListener('mousemove', function (e) {
            if (App.drag.enabled) {
                App.drag.element.style.left = `calc(${e.x + 'px'} - 80vmin / ${App.scene.cols} / 2)`;
                App.drag.element.style.top = `calc(${e.y + 'px'} - 80vmin / 16 * 9 / ${App.scene.rows} / 2)`;
            }
        }, false);
        window.addEventListener('mouseup', function (e) {
            if (App.drag.enabled) {
                App.drag.enabled = false;
                let tilesAtPoint = document.elementsFromPoint(e.x, e.y).filter(el => el.className == 'tile');
                console.log(tilesAtPoint);
                if (tilesAtPoint.length == 2) {
                    // swap tiles
                }
                else {
                    // reset
                    App.drag.element.style.left = 'auto';
                    App.drag.element.style.top = 'auto';
                }
            }
        }, false);
    </script>
</body>
</html>