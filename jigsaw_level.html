<!DOCTYPE html>
<html>
<head>
    <title>jigsaw_level</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            user-select: none;
            /*overflow: hidden;*/
        }

        body {
            margin: 0;
            padding: 0;
            background-color: gray;
            display: table-cell;
            height: 100vh;
            width: 100vw;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <script>
        let rows = 9;
        let cols = 16;
        let field = Array.from(new Array(rows).fill(), () => new Array(cols).fill(0));
        let tile = field[0][0];
        let orig = new Image();
        orig.addEventListener('load', function () {
            orig.style.width = orig.width + 'px';
            orig.style.height = orig.height + 'px';
            field.forEach(function (row, rdx) {
                row.forEach(function (col, cdx) {
                    field[rdx][cdx] = new Tile(rdx, cdx);
                });
            });
            field.forEach(function (row) {
                let cnt = document.createElement('div');
                cnt.style.width = 'fit-content';
                cnt.style.margin = '0 auto';
                row.forEach(function (tile) {
                    cnt.appendChild(tile.cnv);
                });
                document.body.appendChild(cnt);
            });
        });
        orig.src = 'https://i3.ytimg.com/vi/MG_yFJt3PsM/maxresdefault.jpg';
        function Tile(row, col) {
            this.size = new function size() {
                this.visible = Math.min(orig.width, orig.height) / Math.min(rows, cols);
                this.delta = this.visible / 2;
                this.actual = this.visible + this.delta * 2;
            };
            this.pt = {
                tl: {
                    x: this.size.delta,
                    y: this.size.delta
                },
                bl: {
                    x: this.size.delta,
                    y: this.size.delta + this.size.visible
                },
                br: {
                    x: this.size.delta + this.size.visible,
                    y: this.size.delta + this.size.visible
                },
                tr: {
                    x: this.size.delta + this.size.visible,
                    y: this.size.delta
                }
            };
            this.side = {
                l: {
                    a: this.pt.tl,
                    b: this.pt.bl,
                    bridge: (col != 0) && {
                        type: 0,
                        outward: !field[row][col - 1].side.r.bridge.outward,
                        width: field[row][col - 1].side.r.bridge.width
                    }
                },
                b: {
                    a: this.pt.bl,
                    b: this.pt.br,
                    bridge: (row + 1 != rows) && {
                        type: 0,
                        outward: !!Math.floor(Math.random() * 2),
                        width: Math.floor(Math.random() * 11) + 15
                    }
                },
                r: {
                    a: this.pt.br,
                    b: this.pt.tr,
                    bridge: (col + 1 != cols) && {
                        type: 0,
                        outward: !!Math.floor(Math.random() * 2),
                        width: Math.floor(Math.random() * 11) + 15
                    }
                },
                t: {
                    a: this.pt.tr,
                    b: this.pt.tl,
                    bridge: (row != 0) && {
                        type: 0,
                        outward: !field[row - 1][col].side.b.bridge.outward,
                        width: field[row - 1][col].side.b.bridge.width
                    }
                }
            };
            this.pos = new function pos(size) {
                this.x = row * size.visible + size.visible / 2;
                this.y = col * size.visible + size.visible / 2;
            }(this.size);
            this.cnv = document.createElement('canvas');
            this.cnv.width = this.size.actual;
            this.cnv.height = this.size.actual;
            this.ctx = this.cnv.getContext('2d');
            {
                // draw path
                this.ctx.beginPath();
                this.ctx.moveTo(this.pt.tl.x, this.pt.tl.y);
                // left
                if (this.side.l.bridge) {
                    this.ctx.lineTo(this.pt.tl.x, this.pt.tl.y + this.size.visible / 2 - this.side.l.bridge.width / 2);
                    this.ctx.bezierCurveTo(
                        this.pt.tl.x,
                        this.pt.tl.y + this.size.visible / 2,
                        (this.side.l.bridge.outward) ? this.pt.tl.x - this.side.l.bridge.width : this.pt.tl.x + this.side.l.bridge.width,
                        this.pt.tl.y + this.size.visible / 2 - this.side.l.bridge.width,
                        (this.side.l.bridge.outward) ? this.pt.tl.x - this.side.l.bridge.width : this.pt.tl.x + this.side.l.bridge.width,
                        this.pt.tl.y + this.size.visible / 2
                    );
                    this.ctx.bezierCurveTo(
                        (this.side.l.bridge.outward) ? this.pt.tl.x - this.side.l.bridge.width : this.pt.tl.x + this.side.l.bridge.width,
                        this.pt.tl.y + this.size.visible / 2 + this.side.l.bridge.width,
                        this.pt.tl.x,
                        this.pt.tl.y + this.size.visible / 2,
                        this.pt.tl.x,
                        this.pt.tl.y + this.size.visible / 2 + this.side.l.bridge.width / 2
                    );
                }
                this.ctx.lineTo(this.pt.bl.x, this.pt.bl.y);
                // bottom
                if (this.side.b.bridge) {
                    this.ctx.lineTo(this.pt.bl.x + this.size.visible / 2 - this.side.b.bridge.width / 2, this.pt.bl.y);
                    this.ctx.bezierCurveTo(
                        this.pt.bl.x + this.size.visible / 2,
                        this.pt.bl.y,
                        this.pt.bl.x + this.size.visible / 2 - this.side.b.bridge.width,
                        (this.side.b.bridge.outward) ? this.pt.bl.y + this.side.b.bridge.width : this.pt.bl.y - this.side.b.bridge.width,
                        this.pt.bl.x + this.size.visible / 2,
                        (this.side.b.bridge.outward) ? this.pt.bl.y + this.side.b.bridge.width : this.pt.bl.y - this.side.b.bridge.width
                    );
                    this.ctx.bezierCurveTo(
                        this.pt.bl.x + this.size.visible / 2 + this.side.b.bridge.width,
                        (this.side.b.bridge.outward) ? this.pt.bl.y + this.side.b.bridge.width : this.pt.bl.y - this.side.b.bridge.width,
                        this.pt.bl.x + this.size.visible / 2,
                        this.pt.bl.y,
                        this.pt.bl.x + this.size.visible / 2 + this.side.b.bridge.width / 2,
                        this.pt.bl.y
                    );
                }
                this.ctx.lineTo(this.pt.br.x, this.pt.br.y);
                // right
                if (this.side.r.bridge) {
                    this.ctx.lineTo(this.pt.tr.x, this.pt.tr.y + this.size.visible / 2 + this.side.r.bridge.width / 2);
                    this.ctx.bezierCurveTo(
                        this.pt.tr.x,
                        this.pt.tr.y + this.size.visible / 2,
                        (this.side.r.bridge.outward) ? this.pt.tr.x + this.side.r.bridge.width : this.pt.tr.x - this.side.r.bridge.width,
                        this.pt.tr.y + this.size.visible / 2 + this.side.r.bridge.width,
                        (this.side.r.bridge.outward) ? this.pt.tr.x + this.side.r.bridge.width : this.pt.tr.x - this.side.r.bridge.width,
                        this.pt.tr.y + this.size.visible / 2
                    );
                    this.ctx.bezierCurveTo(
                        (this.side.r.bridge.outward) ? this.pt.tr.x + this.side.r.bridge.width : this.pt.tr.x - this.side.r.bridge.width,
                        this.pt.tr.y + this.size.visible / 2 - this.side.r.bridge.width,
                        this.pt.tr.x,
                        this.pt.tr.y + this.size.visible / 2,
                        this.pt.tr.x,
                        this.pt.tr.y + this.size.visible / 2 - this.side.r.bridge.width / 2
                    );
                }
                this.ctx.lineTo(this.pt.tr.x, this.pt.tr.y);
                // top
                if (this.side.t.bridge) {
                    this.ctx.lineTo(this.pt.tl.x + this.size.visible / 2 + this.side.t.bridge.width / 2, this.pt.tl.y);
                    this.ctx.bezierCurveTo(
                        this.pt.tl.x + this.size.visible / 2,
                        this.pt.tl.y,
                        this.pt.tl.x + this.size.visible / 2 + this.side.t.bridge.width,
                        (this.side.t.bridge.outward) ? this.pt.tl.y - this.side.t.bridge.width : this.pt.tl.y + this.side.t.bridge.width,
                        this.pt.tl.x + this.size.visible / 2,
                        (this.side.t.bridge.outward) ? this.pt.tl.y - this.side.t.bridge.width : this.pt.tl.y + this.side.t.bridge.width
                    );
                    this.ctx.bezierCurveTo(
                        this.pt.tl.x + this.size.visible / 2 - this.side.t.bridge.width,
                        (this.side.t.bridge.outward) ? this.pt.tl.y - this.side.t.bridge.width : this.pt.tl.y + this.side.t.bridge.width,
                        this.pt.tl.x + this.size.visible / 2,
                        this.pt.tl.y,
                        this.pt.tl.x + this.size.visible / 2 - this.side.t.bridge.width / 2,
                        this.pt.tl.y
                    );
                }
                this.ctx.lineTo(this.pt.tl.x, this.pt.tl.y);
                this.ctx.closePath();
                //this.ctx.lineWidth = 4;
                //this.ctx.strokeStyle = '#323232';
                //this.ctx.stroke();
                this.ctx.clip();
            }
            // draw actual
            this.ctx.drawImage(
                orig,
                col * this.size.visible - this.size.delta,
                row * this.size.visible - this.size.delta,
                this.size.visible + this.size.delta * 2,
                this.size.visible + this.size.delta * 2,
                0,
                0,
                this.size.actual,
                this.size.actual
            );
        }
    </script>
</body>
</html>