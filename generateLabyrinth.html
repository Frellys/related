<!DOCTYPE html>
<html>
<head>
    <title>generateLabyrinth</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            user-select: none;
            overflow: hidden;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: whitesmoke;
            display: table-cell;
            height: 100vh;
            width: 100vw;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <script>
        const params = new function () {
            let searchParams = window.location.search.substring(1).split('&');
            return Object.fromEntries(searchParams.map(p => { let [k, v] = p.split('='); return [k, +v]; }));
        };
        const Level = function ({ w = 25, h = 25, x1 = Math.floor(Math.random() * 15), y1 = Math.floor(Math.random() * 15) }) {
            this.width = w;
            this.height = h;
            this.start = { x: x1, y: y1 };
            this.field = Array.from(new Array(this.height).fill(), () => new Array(this.width).fill(true));
            this.field[y1][x1] = {
                links: []
            };
            this.path = [];
            let curPath = [];
            let pos = { x: x1, y: y1 };
            while (this.field.some(row => row.some(el => el === true))) {
                let routes = {
                    t: (pos.y > 0 && this.field[pos.y - 1][pos.x] === true),
                    r: (pos.x < this.width - 1 && this.field[pos.y][pos.x + 1] === true),
                    b: (pos.y < this.height - 1 && this.field[pos.y + 1][pos.x] === true),
                    l: (pos.x > 0 && this.field[pos.y][pos.x - 1] === true)
                };
                let cap = Object.keys(routes).filter(key => routes[key]).length;
                if (cap) {
                    if (this.path.length < curPath.push({ x: pos.x, y: pos.y })) {
                        this.path = JSON.parse(JSON.stringify(curPath));
                    }
                    let val = +(window.crypto.getRandomValues(new Uint32Array(1))[0].toString()[0]) % 4;
                    let dir = Object.keys(routes).filter(key => routes[key])[val];
                    this.field[pos.y][pos.x].links.push(dir);
                    switch (dir) {
                        case 't': { pos.y -= 1; this.field[pos.y][pos.x] = { links: ['b'] }; break; }
                        case 'r': { pos.x += 1; this.field[pos.y][pos.x] = { links: ['l'] }; break; }
                        case 'b': { pos.y += 1; this.field[pos.y][pos.x] = { links: ['t'] }; break; }
                        case 'l': { pos.x -= 1; this.field[pos.y][pos.x] = { links: ['r'] }; break; }
                    };
                    // this.field[pos.y][pos.x] = { links: ['b'] }; - old
                    //this.field[pos.y][pos.x] = { links: ['trbl'[('trbl'.indexOf(dir) + 2) % 4]] };
                }
                else {
                    pos = curPath.pop();
                }
            }
            this.xmlns = 'http://www.w3.org/2000/svg';
            this.vmin = Math.floor(Math.min(screen.width, screen.height) / 100);
            this.svg = (() => {
                let svg = document.createElementNS(this.xmlns, 'svg');
                svg.style.display = 'block';
                svg.style.margin = '0 auto';
                svg.setAttribute('shape-rendering', 'optimizespeed');
                svg.setAttribute('viewbox', `0 0 ${this.width} ${this.height}`);
                svg.setAttribute('width', `${this.vmin * 80 + 2}`);
                svg.setAttribute('height', `${this.vmin * 80 + 2}`);
                document.body.appendChild(svg);
                return svg;
            })();
            this.tileSize = this.vmin * 80 / this.width;
            this.field.forEach((row, rdx) => {
                row.forEach((col, cdx) => {
                    this.svg.appendChild(((rect) => {
                        rect.style.fill = 'rgba(50, 50, 50, 0.1)';
                        //rect.style.stroke = 'rgba(50, 50, 50, 0.9)';
                        rect.style.stroke = 'transparent';
                        //rect.style.strokeWidth = 2;
                        rect.setAttribute('x', cdx * this.tileSize + 1);
                        rect.setAttribute('y', rdx * this.tileSize + 1);
                        rect.setAttribute('width', `${this.tileSize}`);
                        rect.setAttribute('height', `${this.tileSize}`);
                        return rect;
                    })(document.createElementNS(this.xmlns, 'rect')));
                    if (this.field[rdx][cdx].links.includes('t') === false) {
                        this.svg.appendChild(((line) => {
                            line.style.stroke = 'rgba(50, 50, 50, 0.9)';
                            line.style.strokeWidth = 2;
                            line.setAttribute('x1', cdx * this.tileSize + 1);
                            line.setAttribute('y1', rdx * this.tileSize + 1);
                            line.setAttribute('x2', (cdx + 1) * this.tileSize + 1);
                            line.setAttribute('y2', (rdx) * this.tileSize + 1);
                            return line;
                        })(document.createElementNS(this.xmlns, 'line')));
                    }
                    if (this.field[rdx][cdx].links.includes('b') === false) {
                        this.svg.appendChild(((line) => {
                            line.style.stroke = 'rgba(50, 50, 50, 0.9)';
                            line.style.strokeWidth = 2;
                            line.setAttribute('x1', cdx * this.tileSize + 1);
                            line.setAttribute('y1', (rdx + 1) * this.tileSize + 1);
                            line.setAttribute('x2', (cdx + 1) * this.tileSize + 1);
                            line.setAttribute('y2', (rdx + 1) * this.tileSize + 1);
                            return line;
                        })(document.createElementNS(this.xmlns, 'line')));
                    }
                    if (this.field[rdx][cdx].links.includes('r') === false) {
                        this.svg.appendChild(((line) => {
                            line.style.stroke = 'rgba(50, 50, 50, 0.9)';
                            line.style.strokeWidth = 2;
                            line.setAttribute('x1', (cdx + 1) * this.tileSize + 1);
                            line.setAttribute('y1', (rdx) * this.tileSize + 1);
                            line.setAttribute('x2', (cdx + 1) * this.tileSize + 1);
                            line.setAttribute('y2', (rdx + 1) * this.tileSize + 1);
                            return line;
                        })(document.createElementNS(this.xmlns, 'line')));
                    }
                    if (this.field[rdx][cdx].links.includes('l') === false) {
                        this.svg.appendChild(((line) => {
                            line.style.stroke = 'rgba(50, 50, 50, 0.9)';
                            line.style.strokeWidth = 2;
                            line.setAttribute('x1', (cdx) * this.tileSize + 1);
                            line.setAttribute('y1', (rdx) * this.tileSize + 1);
                            line.setAttribute('x2', (cdx) * this.tileSize + 1);
                            line.setAttribute('y2', (rdx + 1) * this.tileSize + 1);
                            return line;
                        })(document.createElementNS(this.xmlns, 'line')));
                    }
                });
            });
            this.track = document.createElementNS(this.xmlns, 'polyline');
            this.track.setAttribute('points', this.path.map(p => {
                return [p.x * this.tileSize + this.tileSize / 2 + 1, p.y * this.tileSize + this.tileSize / 2 + 1].join(',');
            }).join(' '));
            this.track.style.fill = 'none';
            this.track.style.stroke = 'hotpink';
            this.track.style.strokeWidth = this.vmin;
            this.svg.appendChild(this.track);
        };
        console.log(new Level(params));
    </script>
</body>
</html>